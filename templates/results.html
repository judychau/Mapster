{% extends 'base.html' %}

{% block head %}

  <script>
  var params

  $(document).ready(function(){
      $("#modal-save").on("click", function(evt){
          evt.preventDefault();
            var category = $('#mycat').serializeArray()[0].value
            var note = $('#mycat').serializeArray()[1].value
            params.category=category
            params.note=note
            $.post(
                    "/savemarker",
                    params,
                    function(data){
                  });
    });

    $(".savedata").on("click", function(evt) {
            evt.preventDefault(); // prevents the routing href=/ on the <a>
            params = $(evt.currentTarget).data(); // takes all the things on current target ('<a>') and turns it to a data object, setting that obj to variable params
            
              
    });
  });
</script>


{% endblock %}

{% block content %}
<div class="container-fluid">

    <form action="/searchresults" method="GET">

      <div class="form-group">
        <div style="float: left">
              <label>Where are you going?:
                  <input type="text" name="location" required class="form-control">
              </label>

              <label>What are you looking for?:
                  <input type="text" name="term" required class="form-control">
              </label>
        </div>
        <div style="float: left">
              <label>Best Matched
                  <input type="radio" name="sort" value="0" class="radio">
              </label>
              
              <label>Distance
                  <input type="radio" name="sort" value="1" class="radio">
              </label>

              <label>Highest Rated
                  <input type="radio" name="sort" value="2" class="radio">
              </label>
        </div>
              <input type="submit" value="Search" class="btn btn-default">

      </div>

    </form>
</div>


<div class="container-fluid">
  <div class="row">
        <table class="table table-hover">
            <thead>

              <tr>
                <th>Name</th>
                <th>Ratings</th>
                <th>Review Count</th>
                <th>Category</th>
                <th>Add to Map</th>
              </tr>

            </thead>



            <tbody>

            {% for business in data %}
              <tr>
                <td> <a href="{{ business['yelp_url'] }}">{{ business['name'] }} </a> </td>
                <td> {{ business['rating'] }} </td>
                <td> {{ business['review_count'] }} </td>
                <td> {{ business['categories'] }} </td>
                <td> {% if "user_id" in session %}
                        <button a href='#' name="marker-button" class="savedata" data-name="{{ business['name'] }}" data-toggle="modal" data-target="#myModal"
                        data-address="{{ business['address'] }}"
                        data-city="{{ business['city'] }}"
                        data-state="{{ business['state'] }}"
                        data-zipcode="{{ business['zipcode'] }}"
                        data-phone="{{ business['phone'] }}"
                        data-categories="{{ business['categories'] }}"
                        data-yelp-id="{{ business['id'] }}"
                        data-yelp-url="{{ business['yelp_url'] }}"
                        data-rating="{{ business['rating'] }}"
                        data-url-rating-stars="{{ business['url_rating_stars'] }}"
                        data-neighborhoods="{{ business['neighborhoods'] }}"
                        data-review-count="{{ business['review_count'] }}"
                        data-latitude="{{ business['latitude'] }}"
                        data-longitude="{{ business['longitude'] }}"> Add</button>
                    {% else %}
                        <p> Log in to add this location to your map! </p>
                    {% endif %}
                </td>
              </tr>
            {% endfor %}

            </tbody>
        </table>
  </div>
</div>

 <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">My map</h4>
        </div>
        <div class="modal-body">
            <form id="mycat" name="mycat" action="#">
              <label>Place:
                  <br>
                    <input type="radio" name="mycat" value="hotel">Hotel
                  <br>
                    <input type="radio" name="mycat" value="sightseeing">Sightseeing
                  <br>
                    <input type="radio" name="mycat" value="activities">Activity
                  <br>
                  <br>
              </label>
              
              <label>Meal:
                  <br>
                    <input type="radio" name="mycat" value="breakfast">Breakfast
                  <br>
                    <input type="radio" name="mycat" value="lunch">Lunch
                  <br>
                    <input type="radio" name="mycat" value="dinner">Dinner
                  <br>
                    <input type="radio" name="mycat" value="snack">Snack
                  <br>
              </label>
                  <br>

              <label>Notes:
                  <br>
                    <input type="text" name="note" class="form-control">
              </label>
                  <br>
                    <input id="modal-save" type="submit" data-dismiss="modal" value="Save to map" class="btn">
            </form>
        </div>
        <div class="modal-footer">
          <button class="btn" id="close_btn" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
  </div>




{% endblock %}
