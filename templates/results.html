{% extends 'base.html' %}

{% block head %}

<p><a href="/mymap">My Map</a></p>

  <script>
  var params

  $(document).ready(function(){
      $("#modal-save").on("click", function(evt){
          evt.preventDefault();
            var category = $('#mycat').serializeArray()[0].value
            var note = $('#mycat').serializeArray()[1].value
            params.category=category
            params.note=note
            $.post(
                    "/savemarker",
                    params,
                    function(data){
                  });
    });

    $(".savedata").on("click", function(evt) {
            evt.preventDefault(); // prevents the routing href=/ on the <a>
            params = $(evt.currentTarget).data(); // takes all the things on current target ('<a>') and turns it to a data object, setting that obj to variable params
            
              
    });
  });
</script>


{% endblock %}

{% block content %}
<div class="row">
      <table>
          <thead>

            <tr>
              <th>Category</th>
              <th>Ratings</th>
              <th>Review Count</th>
              <th>Name</th>
              <th>Add to Map</th>
            </tr>

          </thead>



          <tbody>

            {% for business in data %}
              <td> {{ business['categories'] }} </td>
              <td> {{ business['rating'] }} </td>
              <td> {{ business['review_count'] }} </td>
              <td> <a href="{{ business['yelp_url'] }}">{{ business['name'] }} </a> </td>
              <td> {% if "user_id" in session %}
                      <button a href='#' name="marker-button" class="savedata" data-name="{{ business['name'] }}" data-toggle="modal" data-target="#myModal"
                      data-address="{{ business['address'] }}"
                      data-city="{{ business['city'] }}"
                      data-state="{{ business['state'] }}"
                      data-zipcode="{{ business['zipcode'] }}"
                      data-phone="{{ business['phone'] }}"
                      data-categories="{{ business['categories'] }}"
                      data-yelp-id="{{ business['id'] }}"
                      data-yelp-url="{{ business['yelp_url'] }}"
                      data-rating="{{ business['rating'] }}"
                      data-url-rating-stars="{{ business['url_rating_stars'] }}"
                      data-neighborhoods="{{ business['neighborhoods'] }}"
                      data-review-count="{{ business['review_count'] }}"
                      data-latitude="{{ business['latitude'] }}"
                      data-longitude="{{ business['longitude'] }}"> Add</button>
                  {% else %}
                      <p> Log in to add this location to your map! </p>
                  {% endif %}
              </td>
            {% endfor %}
                
          </tbody>
      </table>
</div>


 <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">My map</h4>
        </div>
        <div class="modal-body">
            <form id="mycat" name="mycat" action="#">
              <label>Place:
                  <br>
                    <input type="radio" name="mycat" value="hotel">Hotel
                  <br>
                    <input type="radio" name="mycat" value="sightseeing">Sightseeing
                  <br>
                    <input type="radio" name="mycat" value="activities">Activity
                  <br>
                  <br>
              </label>
              
              <label>Meal:
                  <br>
                    <input type="radio" name="mycat" value="breakfast">Breakfast
                  <br>
                    <input type="radio" name="mycat" value="lunch">Lunch
                  <br>
                    <input type="radio" name="mycat" value="dinner">Dinner
                  <br>
                    <input type="radio" name="mycat" value="snack">Snack
                  <br>
              </label>
                  <br>

              <label>Notes:
                  <br>
                    <input type="text" name="note" class="form-control">
              </label>
                  <br>
                    <input id="modal-save" type="submit" data-dismiss="modal" value="Save to map" class="btn">
            </form>
        </div>
        <div class="modal-footer">
          <button class="btn" id="close_btn" data-dismiss="modal">Cancel</button>
        </div>
      </div>
      
    </div>
  </div>




{% endblock %}
